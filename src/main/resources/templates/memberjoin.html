<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>회원가입</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
<h1>회원가입</h1>

<div class="navbar">
    <a th:href="@{/certificates}">메인 페이지</a>
    <a th:href="@{/write}">글쓰기 페이지</a>
    <a th:href="@{/register}">회원가입</a>
    <a th:href="@{/login}">로그인</a>
</div>

<div th:if="${errorMessage}" style="color:red;">
    <p th:text="${errorMessage}"></p>
</div>

<form id="registerForm" action="/register" method="post" th:object="${member}">
    <label>ID:
        <input type="text" th:field="*{id}" id="idInput" />
        <button type="button" onclick="checkDuplicate('id')">중복 확인</button>
        <span id="idResult" style="margin-left: 10px;"></span>
    </label><br>

    <label>Password:
        <input type="password" th:field="*{password}" id="passwordInput" />
        <button type="button" onclick="checkDuplicate('password')">중복 확인</button>
        <span id="passwordResult" style="margin-left: 10px;"></span>
    </label><br>

    <label>Name: <input type="text" th:field="*{name}" /></label><br>

    <label>Gender:
        <select th:field="*{gender}">
            <option value="">성별 선택</option>
            <option value="남자">남자</option>
            <option value="여자">여자</option>
        </select>
    </label><br>

    <label>Email:
        <input type="email" th:field="*{email}" id="emailInput" />
        <button type="button" onclick="checkDuplicate('email')">중복 확인</button>
        <span id="emailResult" style="margin-left: 10px;"></span>
    </label><br>

    <button type="submit" id="submitBtn" disabled>회원가입</button>
</form>

<script>
    const checkStatus = { id: false, password: false, email: false };

    function checkDuplicate(type) {
        let value = document.getElementById(type + "Input").value;
        if (!value) {
            alert(type.toUpperCase() + "를 입력하세요.");
            return;
        }

        fetch(`/api/check-duplicate?type=${type}&value=${value}`)
            .then(response => response.json())
            .then(result => {
                const resultSpan = document.getElementById(type + "Result");
                if (result.exists) {
                    resultSpan.innerText = "이미 사용 중";
                    resultSpan.style.color = "red";
                    checkStatus[type] = false;
                } else {
                    resultSpan.innerText = "사용 가능";
                    resultSpan.style.color = "green";
                    checkStatus[type] = true;
                }
                document.getElementById("submitBtn").disabled = !Object.values(checkStatus).every(v => v);
            });
    }
</script>

</body>
</html>
