<!DOCTYPE html>
<html xmlns:layout="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#007bff" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/img/icon-192.png" />
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("/service-worker.js");
        }
    </script>
    <link rel="stylesheet" href="/style.css">
    <title>자격증 게시판</title>
</head>
<body class="form-page">
<div layout:fragment="content">

    <!-- 타이틀 -->
    <h1 class="title">자격증 게시판</h1>

    <!-- 네비게이션 -->
    <div class="navbar">
        <a th:href="@{/certificates}">메인 페이지</a>
        <a th:href="@{/write}">글쓰기 페이지</a>
        <a th:href="@{/register}">회원가입</a>
        <a th:href="@{/login}">로그인</a>
    </div>

    <!-- 폼 컨테이너 -->
    <div class="form-container">
        <h2>회원가입</h2>

        <div th:if="${errorMessage}" style="color:red;">
            <p th:text="${errorMessage}"></p>
        </div>

        <form id="registerForm" action="/register" method="post" th:object="${member}">
            <label>ID:
                <input type="text" th:field="*{id}" id="idInput" />
                <button type="button" onclick="checkDuplicate('id')">중복 확인</button>
                <span id="idResult" style="margin-left: 10px;"></span>
            </label>

            <label>Password:
                <input type="password" th:field="*{password}" id="passwordInput" />
                <button type="button" onclick="checkDuplicate('password')">중복 확인</button>
                <span id="passwordResult" style="margin-left: 10px;"></span>
            </label>

            <label>Name:
                <input type="text" th:field="*{name}" />
            </label>

            <label>Gender:
                <select th:field="*{gender}">
                    <option value="">성별 선택</option>
                    <option value="남자">남자</option>
                    <option value="여자">여자</option>
                </select>
            </label>

            <label>Email:
                <input type="email" th:field="*{email}" id="emailInput" />
                <button type="button" onclick="checkDuplicate('email')">중복 확인</button>
                <span id="emailResult" style="margin-left: 10px;"></span>
            </label>

            <input type="submit" id="submitBtn" value="회원가입" disabled />
        </form>
    </div>

    <script>
        const checkStatus = { id: false, password: false, email: false };

        function checkDuplicate(type) {
            let value = document.getElementById(type + "Input").value;
            if (!value) {
                alert(type.toUpperCase() + "를 입력하세요.");
                return;
            }

            fetch(`/api/check-duplicate?type=${type}&value=${value}`)
                .then(response => response.json())
                .then(result => {
                    const resultSpan = document.getElementById(type + "Result");
                    if (result.exists) {
                        resultSpan.innerText = "이미 사용 중";
                        resultSpan.style.color = "red";
                        checkStatus[type] = false;
                    } else {
                        resultSpan.innerText = "사용 가능";
                        resultSpan.style.color = "green";
                        checkStatus[type] = true;
                    }
                    document.getElementById("submitBtn").disabled = !Object.values(checkStatus).every(v => v);
                });
        }
    </script>

</body>
</html>
